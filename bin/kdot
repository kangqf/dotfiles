#!/bin/sh

usage() {
cat <<EOF
USAGE
  kdot [command] [target@version] [options]

Available Commands:
  install     安装
  uninstall   卸载
  reinstall   重新安装
  upgrade     升级
  config      配置
  tips        常见cmd用法
  help        显示此信息

Available target:
  ${pkg}  安装软件
  ${cmd}  命令常见用法

Available options:
  -scenario {场景 | dev vps work board}
  -os {os@version 系统版本 | ubuntu@22.04}
  -arch {架构 | arm64}
  -device {device@index 设备序号 | rk3399@1 xps13 ipad2020}
  -collect {软件包 init}

Example usage:
  kdot install zsh -os mac@13 -scenario dev -device xps13
  kdot config sys -scenario dev -os win
EOF
}

main() {
  KSCENARIO="default"
  KOS="default"
  KDEVICE="default"
  KACTION=$1
  KTARGET=$2
  shift 2
  while [ $# -gt 0 ]
  do
      case $1 in
        -scenario)
          KSCENARIO=$2
          ;;
        -device)
          KDEVICE=$2
          ;;
        -os)
          KOS=$2
         ;;
         *)
          echo "指定的参数无效. 请运行 dot help."
          ;;
      esac
    shift 2
  done

  echo "param: $KACTION $KTARGET $KSCENARIO $KOS $KDEVICE"

  case $KACTION in
    install)
      sh $KDOTDIR/cmd/install.sh $KTARGET $KSCENARIO $KOS $KDEVICE
      ;;
    uninstall)
      echo "kdot uninstall $KSCENARIO $KOS $KDEVICE"
      #sh $KDOTDIR/cmd/uninstall.sh $KTARGET $KSCENARIO $KOS $KDEVICE
      ;;
    config)
      echo "kdot config $KSCENARIO $KOS $KDEVICE"
      sh $KDOTDIR/cmd/config.sh $KTARGET $KSCENARIO $KOS $KDEVICE
      ;;
    help)
      usage
      ;;
     *)
      echo "指定的命令无效. 请运行 dot help."
      ;;
  esac
}

if [ $# -lt 2 ]; then
    echo "参数不正确. 请运行 dot help."
    exit 1
fi

main "$@"
